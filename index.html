<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Manifest (Inline) -->
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%2212ì£¼%20ê±´ê°•%20ì²´í¬ë¦¬ìŠ¤íŠ¸%22,%22short_name%22:%22ê±´ê°•ì²´í¬%22,%22description%22:%2212ì£¼ê°„ì˜%20ê±´ê°•%20ê´€ë¦¬ë¥¼%20ìœ„í•œ%20ì²´í¬ë¦¬ìŠ¤íŠ¸%20ì•±%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23667eea%22,%22theme_color%22:%22%23667eea%22,%22orientation%22:%22portrait-primary%22,%22scope%22:%22./%22,%22lang%22:%22ko%22,%22categories%22:[%22health%22,%22lifestyle%22,%22productivity%22],%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20192%20192'%3E%3Cdefs%3E%3ClinearGradient%20id='grad'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3E%3Cstop%20offset='0%25'%20style='stop-color:%23667eea;stop-opacity:1'%20/%3E%3Cstop%20offset='100%25'%20style='stop-color:%23764ba2;stop-opacity:1'%20/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect%20width='192'%20height='192'%20rx='24'%20fill='url(%23grad)'/%3E%3Ccircle%20cx='96'%20cy='70'%20r='30'%20fill='white'%20opacity='0.9'/%3E%3Crect%20x='66'%20y='100'%20width='60'%20height='8'%20rx='4'%20fill='white'%20opacity='0.9'/%3E%3Crect%20x='66'%20y='115'%20width='45'%20height='8'%20rx='4'%20fill='white'%20opacity='0.7'/%3E%3Crect%20x='66'%20y='130'%20width='50'%20height='8'%20rx='4'%20fill='white'%20opacity='0.7'/%3E%3Crect%20x='66'%20y='145'%20width='40'%20height='8'%20rx='4'%20fill='white'%20opacity='0.5'/%3E%3Ctext%20x='96'%20y='75'%20font-family='Arial'%20font-size='20'%20font-weight='bold'%20fill='%23667eea'%20text-anchor='middle'%3Eâœ“%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%20maskable%22},{%22src%22:%22data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3E%3Cdefs%3E%3ClinearGradient%20id='grad'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3E%3Cstop%20offset='0%25'%20style='stop-color:%23667eea;stop-opacity:1'%20/%3E%3Cstop%20offset='100%25'%20style='stop-color:%23764ba2;stop-opacity:1'%20/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect%20width='512'%20height='512'%20rx='64'%20fill='url(%23grad)'/%3E%3Ccircle%20cx='256'%20cy='180'%20r='80'%20fill='white'%20opacity='0.9'/%3E%3Crect%20x='176'%20y='280'%20width='160'%20height='20'%20rx='10'%20fill='white'%20opacity='0.9'/%3E%3Crect%20x='176'%20y='315'%20width='120'%20height='20'%20rx='10'%20fill='white'%20opacity='0.7'/%3E%3Crect%20x='176'%20y='350'%20width='130'%20height='20'%20rx='10'%20fill='white'%20opacity='0.7'/%3E%3Crect%20x='176'%20y='385'%20width='100'%20height='20'%20rx='10'%20fill='white'%20opacity='0.5'/%3E%3Ctext%20x='256'%20y='195'%20font-family='Arial'%20font-size='50'%20font-weight='bold'%20fill='%23667eea'%20text-anchor='middle'%3Eâœ“%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%20maskable%22}]}">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ê±´ê°•ì²´í¬">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%23667eea;stop-opacity:1' /><stop offset='100%' style='stop-color:%23764ba2;stop-opacity:1' /></linearGradient></defs><rect width='180' height='180' rx='20' fill='url(%23grad)'/><circle cx='90' cy='65' r='25' fill='white' opacity='0.9'/><rect x='65' y='95' width='50' height='6' rx='3' fill='white' opacity='0.9'/><rect x='65' y='107' width='38' height='6' rx='3' fill='white' opacity='0.7'/><rect x='65' y='119' width='42' height='6' rx='3' fill='white' opacity='0.7'/><rect x='65' y='131' width='33' height='6' rx='3' fill='white' opacity='0.5'/><text x='90' y='72' font-family='Arial' font-size='16' font-weight='bold' fill='%23667eea' text-anchor='middle'>âœ“</text></svg>">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%23667eea;stop-opacity:1' /><stop offset='100%' style='stop-color:%23764ba2;stop-opacity:1' /></linearGradient></defs><rect width='32' height='32' rx='4' fill='url(%23grad)'/><circle cx='16' cy='12' r='4' fill='white' opacity='0.9'/><rect x='12' y='18' width='8' height='2' rx='1' fill='white' opacity='0.9'/><rect x='12' y='21' width='6' height='2' rx='1' fill='white' opacity='0.7'/><rect x='12' y='24' width='7' height='2' rx='1' fill='white' opacity='0.7'/><text x='16' y='14' font-family='Arial' font-size='3' font-weight='bold' fill='%23667eea' text-anchor='middle'>âœ“</text></svg>">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-navbutton-color" content="#667eea">
    
    <!-- Description -->
    <meta name="description" content="12ì£¼ê°„ì˜ ê±´ê°• ê´€ë¦¬ë¥¼ ìœ„í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•±. ì‹ë‹¨, ìˆ˜ë¶„ ì„­ì·¨, ìš´ë™ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.">
    <meta name="keywords" content="ê±´ê°•, ì²´í¬ë¦¬ìŠ¤íŠ¸, ë‹¤ì´ì–´íŠ¸, ìš´ë™, ìˆ˜ë¶„ì„­ì·¨, ì‹ë‹¨ê´€ë¦¬">
    
    <title>12ì£¼ ê±´ê°• ì²´í¬ë¦¬ìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .week-info {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .week-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }

        .week-selector button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-selector button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .week-selector button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .week-display {
            font-size: 18px;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .progress-container {
            padding: 20px;
            background: linear-gradient(to right, #f5f7fa 0%, #c3cfe2 100%);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #555;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .day-tabs {
            display: flex;
            overflow-x: auto;
            padding: 0 20px;
            margin-top: 20px;
            gap: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .day-tabs::-webkit-scrollbar {
            display: none;
        }

        .day-tab {
            flex: 0 0 auto;
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
            white-space: nowrap;
        }

        .day-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .checklist-container {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .checklist-item {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .checklist-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .checklist-item.checked::before {
            opacity: 1;
        }

        .checklist-item:active {
            transform: scale(0.98);
        }

        .checkbox-wrapper {
            position: relative;
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .checkbox {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkbox-custom {
            position: absolute;
            top: 0;
            left: 0;
            width: 24px;
            height: 24px;
            background: #f0f0f0;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkbox:checked ~ .checkbox-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.1);
        }

        .checkbox-custom::after {
            content: 'âœ“';
            color: white;
            font-size: 16px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .checkbox:checked ~ .checkbox-custom::after {
            opacity: 1;
            transform: scale(1);
        }

        .checklist-text {
            flex: 1;
            font-size: 16px;
            color: #333;
            line-height: 1.4;
        }

        .checklist-item.checked .checklist-text {
            color: #999;
            text-decoration: line-through;
        }

        .special-note {
            font-size: 12px;
            color: #667eea;
            font-weight: 500;
            margin-top: 4px;
        }

        .time-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .float-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .float-button:hover {
            transform: scale(1.1) rotate(90deg);
        }

        .alarm-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            min-width: 300px;
            max-width: 90vw;
        }

        .alarm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .alarm-overlay.show {
            display: block;
        }

        .alarm-panel.show {
            display: block;
        }

        .alarm-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .alarm-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .alarm-switch.active {
            background: #667eea;
        }

        .alarm-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .alarm-switch.active::after {
            transform: translateX(26px);
        }

        .notification-permission {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 15px;
            width: 100%;
        }

        .alarm-bell {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .alarm-bell:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .alarm-bell.ringing {
            animation: ring 0.5s ease-in-out infinite alternate;
        }

        @keyframes ring {
            0% { transform: rotate(-10deg); }
            100% { transform: rotate(10deg); }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            
            .container {
                border-radius: 0;
                min-height: 100vh;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .day-tab {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .checklist-text {
                font-size: 15px;
            }
            
            .alarm-panel {
                top: 50%;
                left: 50%;
                right: auto;
                transform: translate(-50%, -50%);
                min-width: auto;
                width: 90%;
                max-width: 400px;
            }
            
            .header-content {
                gap: 10px;
            }
            
            .alarm-bell {
                width: 35px;
                height: 35px;
                font-size: 16px;
                margin-left: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-text">
                    <h1>12ì£¼ ê±´ê°• ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
                </div>
                <div class="alarm-bell" onclick="toggleAlarmPanel()" id="alarmBell">ğŸ””</div>
            </div>
            <div class="week-info" id="weekInfo"></div>
            <div class="week-selector">
                <button onclick="changeWeek(-1)" id="prevWeek">â€¹</button>
                <div class="week-display" id="weekDisplay">1ì£¼ì°¨</div>
                <button onclick="changeWeek(1)" id="nextWeek">â€º</button>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-stats">
                <div class="stat-item">
                    <div class="stat-value" id="weekProgress">0%</div>
                    <div class="stat-label">ì´ë²ˆ ì£¼ ì§„í–‰ë¥ </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalProgress">0%</div>
                    <div class="stat-label">ì „ì²´ ì§„í–‰ë¥ </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completedDays">0/84</div>
                    <div class="stat-label">ì™„ë£Œ ì¼ìˆ˜</div>
                </div>
            </div>
            <div class="progress-info">
                <span>ì˜¤ëŠ˜ì˜ ì§„í–‰ë¥ </span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="day-tabs" id="dayTabs"></div>
        
        <div class="checklist-container" id="checklistContainer"></div>
    </div>
    
    <div class="alarm-overlay" id="alarmOverlay" onclick="closeAlarmPanel()"></div>
    <div class="alarm-panel" id="alarmPanel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: #333;">ì•Œë¦¼ ì„¤ì •</h3>
            <button onclick="closeAlarmPanel()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">Ã—</button>
        </div>
        
        <button class="notification-permission" onclick="requestNotificationPermission()" id="permissionBtn">
            ì•Œë¦¼ ê¶Œí•œ í—ˆìš©í•˜ê¸°
        </button>
        
        <div class="alarm-toggle">
            <span>ìˆ˜ë¶„ ì„­ì·¨ ì•Œë¦¼</span>
            <div class="alarm-switch" data-type="water" onclick="toggleAlarm(this)"></div>
        </div>
        
        <div class="alarm-toggle">
            <span>ì‹ì‚¬ ì‹œê°„ ì•Œë¦¼</span>
            <div class="alarm-switch" data-type="meal" onclick="toggleAlarm(this)"></div>
        </div>
        
        <div class="alarm-toggle">
            <span>ë¼ì´ë”© ì‹œì‘ ì•Œë¦¼</span>
            <div class="alarm-switch" data-type="riding" onclick="toggleAlarm(this)"></div>
        </div>
        
        <div class="alarm-toggle">
            <span>ì§„í–‰ë¥  ì²´í¬ ì•Œë¦¼</span>
            <div class="alarm-switch" data-type="progress" onclick="toggleAlarm(this)"></div>
        </div>
    </div>
    
    <div class="float-button" onclick="showResetMenu()">â†»</div>
    
    <script>
        const checklistData = {
            'ì›”': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'mon-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'mon-breakfast', time: '08:00' },
                { text: '09:00~11:00 ìì „ê±° ë¼ì´ë”© 3ì‹œê°„', id: 'mon-riding', time: '09:00~11:00' },
                { text: 'ìš´ë™ ì¤‘ ë¬¼ 500~700ml', id: 'mon-water-exercise', time: 'ìš´ë™ ì¤‘' },
                { text: 'ìš´ë™ ì¤‘ ë‹¨ë°±ì§ˆ ì‰ì´í¬', id: 'mon-protein-shake-exercise', time: 'ìš´ë™ ì¤‘' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'mon-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'mon-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'mon-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'mon-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'mon-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'mon-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'mon-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'mon-carb' },
                { text: 'ìˆ  ë‹¤ìŒë‚  3ì‹œê°„ ë¼ì´ë”©', id: 'mon-alcohol-riding', special: 'ì›”ìš”ì¼ ì „ìš©' }
            ],
            'í™”': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'tue-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'tue-breakfast', time: '08:00' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'tue-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'tue-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'tue-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'tue-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'tue-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'tue-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'tue-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'tue-carb' }
            ],
            'ìˆ˜': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'wed-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'wed-breakfast', time: '08:00' },
                { text: '09:00~11:00 ìì „ê±° ë¼ì´ë”© 3ì‹œê°„', id: 'wed-riding', time: '09:00~11:00' },
                { text: 'ìš´ë™ ì¤‘ ë¬¼ 500~700ml', id: 'wed-water-exercise', time: 'ìš´ë™ ì¤‘' },
                { text: 'ìš´ë™ ì¤‘ ë‹¨ë°±ì§ˆ ì‰ì´í¬', id: 'wed-protein-shake-exercise', time: 'ìš´ë™ ì¤‘' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'wed-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'wed-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'wed-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'wed-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'wed-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'wed-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'wed-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'wed-carb' }
            ],
            'ëª©': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'thu-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'thu-breakfast', time: '08:00' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'thu-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'thu-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'thu-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'thu-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'thu-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'thu-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'thu-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'thu-carb' }
            ],
            'ê¸ˆ': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'fri-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'fri-breakfast', time: '08:00' },
                { text: '09:00~11:00 ìì „ê±° ë¼ì´ë”© 3ì‹œê°„', id: 'fri-riding', time: '09:00~11:00' },
                { text: 'ìš´ë™ ì¤‘ ë¬¼ 500~700ml', id: 'fri-water-exercise', time: 'ìš´ë™ ì¤‘' },
                { text: 'ìš´ë™ ì¤‘ ë‹¨ë°±ì§ˆ ì‰ì´í¬', id: 'fri-protein-shake-exercise', time: 'ìš´ë™ ì¤‘' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'fri-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'fri-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'fri-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'fri-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'fri-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'fri-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'fri-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'fri-carb' }
            ],
            'í† ': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'sat-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'sat-breakfast', time: '08:00' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'sat-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'sat-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'sat-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'sat-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'sat-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'sat-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'sat-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'sat-carb' }
            ],
            'ì¼': [
                { text: 'ê¸°ìƒ ì§í›„ ë¬¼ 300~500ml', id: 'sun-water-morning', time: 'ê¸°ìƒ ì§í›„' },
                { text: '08:00 ì•„ì¹¨ì‹ì‚¬ (ê³ ì • êµ¬ì„±)', id: 'sun-breakfast', time: '08:00' },
                { text: '11:30 ì ì‹¬ì‹ì‚¬ (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)', id: 'sun-lunch', time: '11:30' },
                { text: 'ì˜¤í›„ ë¬¼ 600~800ml', id: 'sun-water-afternoon', time: 'ì˜¤í›„' },
                { text: '15:00 ê°„ì‹ (ì‰ì´í¬)', id: 'sun-snack', time: '15:00' },
                { text: '18:30 ì €ë…ì‹ì‚¬ (ì†Œê³ ê¸° + ì±„ì†Œ)', id: 'sun-dinner', time: '18:30' },
                { text: 'ì €ë… ë¬¼ 500~700ml', id: 'sun-water-evening', time: 'ì €ë…' },
                { text: 'ì·¨ì¹¨ ì „ ë¬¼ 150~200ml', id: 'sun-water-bedtime', time: 'ì·¨ì¹¨ ì „' },
                { text: 'ë‹¨ë°±ì§ˆ â‰¥ 150g', id: 'sun-protein' },
                { text: 'íƒ„ìˆ˜í™”ë¬¼ â‰¤ 120g', id: 'sun-carb' },
                { text: 'ìˆ  ë§ˆì‹¬ ì—¬ë¶€', id: 'sun-alcohol', special: 'ì¼ìš”ì¼ ì „ìš©' }
            ]
        };

        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        let currentDay = days[new Date().getDay()];
        let currentWeek = 1;
        let checkedItems = JSON.parse(localStorage.getItem('healthChecklist12Weeks')) || {};
        let alarmSettings = JSON.parse(localStorage.getItem('alarmSettings')) || {
            water: false,
            meal: false,
            riding: false,
            progress: false
        };
        let alarmIntervals = [];
        let notificationPermission = false;

        function initApp() {
            // Initialize data structure for 12 weeks if not exists
            if (!checkedItems.weeks) {
                checkedItems = { weeks: {} };
                for (let i = 1; i <= 12; i++) {
                    checkedItems.weeks[i] = {};
                }
                localStorage.setItem('healthChecklist12Weeks', JSON.stringify(checkedItems));
            }
            updateWeekInfo();
            updateWeekDisplay();
            createDayTabs();
            selectDay(currentDay);
            updateProgress();
            updateStats();
        }

        function updateWeekInfo() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayName = days[now.getDay()];
            document.getElementById('weekInfo').textContent = `${month}ì›” ${date}ì¼ ${dayName}ìš”ì¼`;
        }

        function createDayTabs() {
            const container = document.getElementById('dayTabs');
            days.forEach(day => {
                const tab = document.createElement('button');
                tab.className = 'day-tab';
                tab.textContent = day + 'ìš”ì¼';
                tab.onclick = () => selectDay(day);
                container.appendChild(tab);
            });
        }

        function selectDay(day) {
            currentDay = day;
            
            document.querySelectorAll('.day-tab').forEach((tab, index) => {
                tab.classList.toggle('active', days[index] === day);
            });
            
            renderChecklist();
            updateProgress();
        }

        function renderChecklist() {
            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';
            
            const items = checklistData[currentDay];
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'checklist-item';
                const itemKey = `week${currentWeek}_${item.id}`;
                const uniqueId = `${item.id}_week${currentWeek}_${index}`;
                
                // Ensure week data exists
                if (!checkedItems.weeks[currentWeek]) {
                    checkedItems.weeks[currentWeek] = {};
                }
                
                const isChecked = checkedItems.weeks[currentWeek][itemKey] || false;
                if (isChecked) {
                    div.classList.add('checked');
                }
                
                div.innerHTML = `
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="${uniqueId}" class="checkbox" 
                               ${isChecked ? 'checked' : ''}>
                        <div class="checkbox-custom"></div>
                    </div>
                    <div class="checklist-text">
                        ${item.time ? `<div class="time-badge">${item.time}</div>` : ''}
                        ${item.text}
                        ${item.special ? `<div class="special-note">${item.special}</div>` : ''}
                    </div>
                `;
                
                const checkbox = div.querySelector('.checkbox');
                const checkboxWrapper = div.querySelector('.checkbox-wrapper');
                
                // Add click event to both checkbox and wrapper for better UX
                const handleToggle = (e) => {
                    e.stopPropagation();
                    const newChecked = !checkbox.checked;
                    checkbox.checked = newChecked;
                    checkedItems.weeks[currentWeek][itemKey] = newChecked;
                    localStorage.setItem('healthChecklist12Weeks', JSON.stringify(checkedItems));
                    div.classList.toggle('checked', newChecked);
                    updateProgress();
                    updateStats();
                };
                
                checkbox.addEventListener('change', handleToggle);
                checkboxWrapper.addEventListener('click', (e) => {
                    if (e.target === checkbox) return; // Prevent double trigger
                    handleToggle(e);
                });
                
                container.appendChild(div);
            });
        }

        function updateProgress() {
            const items = checklistData[currentDay];
            const checkedCount = items.filter(item => {
                const itemKey = `week${currentWeek}_${item.id}`;
                return checkedItems.weeks[currentWeek][itemKey];
            }).length;
            const totalCount = items.length;
            const percentage = Math.round((checkedCount / totalCount) * 100);
            
            document.getElementById('progressPercent').textContent = `${percentage}%`;
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }

        function updateStats() {
            // Calculate week progress
            let weekTotal = 0;
            let weekChecked = 0;
            days.forEach(day => {
                const items = checklistData[day];
                weekTotal += items.length;
                weekChecked += items.filter(item => {
                    const itemKey = `week${currentWeek}_${item.id}`;
                    return checkedItems.weeks[currentWeek][itemKey];
                }).length;
            });
            const weekProgress = Math.round((weekChecked / weekTotal) * 100);
            document.getElementById('weekProgress').textContent = `${weekProgress}%`;

            // Calculate total progress
            let totalChecked = 0;
            let totalItems = 0;
            for (let week = 1; week <= 12; week++) {
                days.forEach(day => {
                    const items = checklistData[day];
                    totalItems += items.length;
                    totalChecked += items.filter(item => {
                        const itemKey = `week${week}_${item.id}`;
                        return checkedItems.weeks[week] && checkedItems.weeks[week][itemKey];
                    }).length;
                });
            }
            const totalProgress = Math.round((totalChecked / totalItems) * 100);
            document.getElementById('totalProgress').textContent = `${totalProgress}%`;

            // Calculate completed days
            let completedDays = 0;
            for (let week = 1; week <= 12; week++) {
                days.forEach(day => {
                    const items = checklistData[day];
                    const dayCompleted = items.every(item => {
                        const itemKey = `week${week}_${item.id}`;
                        return checkedItems.weeks[week] && checkedItems.weeks[week][itemKey];
                    });
                    if (dayCompleted) completedDays++;
                });
            }
            document.getElementById('completedDays').textContent = `${completedDays}/84`;
        }

        function changeWeek(direction) {
            const newWeek = currentWeek + direction;
            if (newWeek >= 1 && newWeek <= 12) {
                currentWeek = newWeek;
                updateWeekDisplay();
                renderChecklist();
                updateProgress();
                updateStats();
            }
        }

        function updateWeekDisplay() {
            document.getElementById('weekDisplay').textContent = `${currentWeek}ì£¼ì°¨`;
            document.getElementById('prevWeek').disabled = currentWeek === 1;
            document.getElementById('nextWeek').disabled = currentWeek === 12;
        }

        function showResetMenu() {
            const choice = confirm('í˜„ì¬ ì£¼ì°¨ë§Œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní™•ì¸: í˜„ì¬ ì£¼ì°¨ë§Œ ì´ˆê¸°í™”\nì·¨ì†Œ: ì „ì²´ 12ì£¼ ì´ˆê¸°í™” ì—¬ë¶€ ë¬»ê¸°');
            
            if (choice) {
                // Reset current week only
                if (confirm(`${currentWeek}ì£¼ì°¨ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    checkedItems.weeks[currentWeek] = {};
                    localStorage.setItem('healthChecklist12Weeks', JSON.stringify(checkedItems));
                    renderChecklist();
                    updateProgress();
                    updateStats();
                }
            } else {
                // Ask for full reset
                if (confirm('ì •ë§ë¡œ 12ì£¼ ì „ì²´ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤!')) {
                    checkedItems = { weeks: {} };
                    for (let i = 1; i <= 12; i++) {
                        checkedItems.weeks[i] = {};
                    }
                    localStorage.setItem('healthChecklist12Weeks', JSON.stringify(checkedItems));
                    renderChecklist();
                    updateProgress();
                    updateStats();
                }
            }
        }

        // Alarm Functions
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    notificationPermission = true;
                    document.getElementById('permissionBtn').textContent = 'ì•Œë¦¼ ê¶Œí•œ í—ˆìš©ë¨ âœ“';
                    document.getElementById('permissionBtn').style.background = '#4CAF50';
                    initializeAlarms();
                } else {
                    alert('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }
            } else {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        function toggleAlarmPanel() {
            const panel = document.getElementById('alarmPanel');
            const overlay = document.getElementById('alarmOverlay');
            
            if (panel.classList.contains('show')) {
                closeAlarmPanel();
            } else {
                panel.classList.add('show');
                overlay.classList.add('show');
                // Prevent body scroll when modal is open
                document.body.style.overflow = 'hidden';
            }
        }

        function closeAlarmPanel() {
            const panel = document.getElementById('alarmPanel');
            const overlay = document.getElementById('alarmOverlay');
            
            panel.classList.remove('show');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
        }

        function toggleAlarm(element) {
            const type = element.dataset.type;
            element.classList.toggle('active');
            alarmSettings[type] = element.classList.contains('active');
            localStorage.setItem('alarmSettings', JSON.stringify(alarmSettings));
            
            if (notificationPermission) {
                if (alarmSettings[type]) {
                    startAlarms(type);
                } else {
                    stopAlarms(type);
                }
            }
        }

        function initializeAlarms() {
            // Load saved alarm settings
            Object.keys(alarmSettings).forEach(type => {
                const element = document.querySelector(`[data-type="${type}"]`);
                if (alarmSettings[type]) {
                    element.classList.add('active');
                    startAlarms(type);
                }
            });
        }

        function startAlarms(type) {
            switch(type) {
                case 'water':
                    startWaterAlarms();
                    break;
                case 'meal':
                    startMealAlarms();
                    break;
                case 'riding':
                    startRidingAlarms();
                    break;
                case 'progress':
                    startProgressAlarms();
                    break;
            }
        }

        function stopAlarms(type) {
            alarmIntervals = alarmIntervals.filter(interval => {
                if (interval.type === type) {
                    clearInterval(interval.id);
                    return false;
                }
                return true;
            });
        }

        function startWaterAlarms() {
            const waterTimes = [
                { hour: 7, minute: 40, message: 'ğŸŒ… ê¸°ìƒ ì§í›„ ë¬¼ ë§ˆì‹¤ ì‹œê°„ì…ë‹ˆë‹¤! (300~500ml)' },
                { hour: 10, minute: 0, message: 'ğŸ’§ ìš´ë™ ì¤‘ ë¬¼ ë§ˆì‹¤ ì‹œê°„ì…ë‹ˆë‹¤! (500~700ml)' },
                { hour: 14, minute: 0, message: 'â˜€ï¸ ì˜¤í›„ ë¬¼ ë§ˆì‹¤ ì‹œê°„ì…ë‹ˆë‹¤! (600~800ml)' },
                { hour: 19, minute: 0, message: 'ğŸŒ† ì €ë… ë¬¼ ë§ˆì‹¤ ì‹œê°„ì…ë‹ˆë‹¤! (500~700ml)' },
                { hour: 22, minute: 0, message: 'ğŸŒ™ ì·¨ì¹¨ ì „ ë¬¼ ë§ˆì‹¤ ì‹œê°„ì…ë‹ˆë‹¤! (150~200ml)' }
            ];

            const checkWaterTime = () => {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();

                waterTimes.forEach(time => {
                    if (currentHour === time.hour && currentMinute === time.minute && now.getSeconds() === 0) {
                        showNotification('ğŸ’§ ìˆ˜ë¶„ ì„­ì·¨ ì•Œë¦¼', time.message);
                        ringAlarmBell();
                    }
                });
            };

            const intervalId = setInterval(checkWaterTime, 1000);
            alarmIntervals.push({ type: 'water', id: intervalId });
        }

        function startMealAlarms() {
            const mealTimes = [
                { hour: 8, minute: 0, message: 'ğŸ³ ì•„ì¹¨ì‹ì‚¬ ì‹œê°„ì…ë‹ˆë‹¤! (ê³ ì • êµ¬ì„±)' },
                { hour: 11, minute: 30, message: 'ğŸš ì ì‹¬ì‹ì‚¬ ì‹œê°„ì…ë‹ˆë‹¤! (ê³ ë‹¨ë°± + í˜„ë¯¸ë°¥)' },
                { hour: 15, minute: 0, message: 'ğŸ¥¤ ê°„ì‹ ì‹œê°„ì…ë‹ˆë‹¤! (ì‰ì´í¬)' },
                { hour: 18, minute: 30, message: 'ğŸ¥© ì €ë…ì‹ì‚¬ ì‹œê°„ì…ë‹ˆë‹¤! (ì†Œê³ ê¸° + ì±„ì†Œ)' }
            ];

            const checkMealTime = () => {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();

                mealTimes.forEach(time => {
                    if (currentHour === time.hour && currentMinute === time.minute && now.getSeconds() === 0) {
                        showNotification('ğŸ½ï¸ ì‹ì‚¬ ì‹œê°„ ì•Œë¦¼', time.message);
                        ringAlarmBell();
                    }
                });
            };

            const intervalId = setInterval(checkMealTime, 1000);
            alarmIntervals.push({ type: 'meal', id: intervalId });
        }

        function startRidingAlarms() {
            const checkRidingTime = () => {
                const now = new Date();
                const currentDay = days[now.getDay()];
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();

                // ì›”/ìˆ˜/ê¸ˆ 09:00ì— ë¼ì´ë”© ì•Œë¦¼
                if (['ì›”', 'ìˆ˜', 'ê¸ˆ'].includes(currentDay) && 
                    currentHour === 9 && currentMinute === 0 && now.getSeconds() === 0) {
                    showNotification('ğŸš´ ë¼ì´ë”© ì‹œì‘ ì•Œë¦¼', 'ìì „ê±° ë¼ì´ë”© ì‹œê°„ì…ë‹ˆë‹¤! (3ì‹œê°„)');
                    ringAlarmBell();
                }
            };

            const intervalId = setInterval(checkRidingTime, 1000);
            alarmIntervals.push({ type: 'riding', id: intervalId });
        }

        function startProgressAlarms() {
            const checkProgressTime = () => {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();

                // í•˜ë£¨ 3ë²ˆ ì§„í–‰ë¥  ì²´í¬ (12:00, 18:00, 21:00)
                if ([12, 18, 21].includes(currentHour) && currentMinute === 0 && now.getSeconds() === 0) {
                    const items = checklistData[currentDay];
                    const checkedCount = items.filter(item => {
                        const itemKey = `week${currentWeek}_${item.id}`;
                        return checkedItems.weeks[currentWeek][itemKey];
                    }).length;
                    const totalCount = items.length;
                    const percentage = Math.round((checkedCount / totalCount) * 100);

                    let message = '';
                    if (percentage === 100) {
                        message = `ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ ëª©í‘œë¥¼ ëª¨ë‘ ë‹¬ì„±í–ˆì–´ìš”!`;
                    } else if (percentage >= 70) {
                        message = `ğŸ‘ ì˜í•˜ê³  ìˆì–´ìš”! í˜„ì¬ ${percentage}% ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.`;
                    } else if (percentage >= 50) {
                        message = `ğŸ’ª ì¡°ê¸ˆ ë” í˜ë‚´ì„¸ìš”! í˜„ì¬ ${percentage}% ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.`;
                    } else {
                        message = `â° ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”! í˜„ì¬ ${percentage}% ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.`;
                    }

                    showNotification('ğŸ“Š ì§„í–‰ë¥  ì²´í¬', message);
                    ringAlarmBell();
                }
            };

            const intervalId = setInterval(checkProgressTime, 1000);
            alarmIntervals.push({ type: 'progress', id: intervalId });
        }

        function showNotification(title, message) {
            if (notificationPermission && 'Notification' in window) {
                new Notification(title, {
                    body: message,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23667eea"/><text x="50" y="60" font-family="Arial" font-size="40" fill="white" text-anchor="middle">ğŸ’§</text></svg>',
                    requireInteraction: true,
                    vibrate: [200, 100, 200]
                });
            }
        }

        function ringAlarmBell() {
            const bell = document.getElementById('alarmBell');
            bell.classList.add('ringing');
            setTimeout(() => {
                bell.classList.remove('ringing');
            }, 2000);

            // Vibration for mobile devices
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        // Check notification permission on load
        function checkNotificationPermission() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    notificationPermission = true;
                    document.getElementById('permissionBtn').textContent = 'ì•Œë¦¼ ê¶Œí•œ í—ˆìš©ë¨ âœ“';
                    document.getElementById('permissionBtn').style.background = '#4CAF50';
                    initializeAlarms();
                } else if (Notification.permission === 'denied') {
                    document.getElementById('permissionBtn').textContent = 'ì•Œë¦¼ ê¶Œí•œ ê±°ë¶€ë¨ âœ—';
                    document.getElementById('permissionBtn').style.background = '#f44336';
                }
            }
        }

        // ESC key to close alarm panel
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAlarmPanel();
            }
        });

        // Inline Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                const swCode = `
                    const CACHE_NAME = 'health-checklist-v1';
                    const urlsToCache = ['./', './index.html'];
                    
                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME).then(function(cache) {
                                return cache.addAll(urlsToCache);
                            })
                        );
                    });
                    
                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request).then(function(response) {
                                return response || fetch(event.request);
                            })
                        );
                    });
                    
                    self.addEventListener('activate', function(event) {
                        event.waitUntil(
                            caches.keys().then(function(cacheNames) {
                                return Promise.all(
                                    cacheNames.map(function(cacheName) {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                    });
                    
                    self.addEventListener('notificationclick', function(event) {
                        event.notification.close();
                        event.waitUntil(clients.openWindow('./'));
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button or banner
            showInstallPrompt();
        });

        function showInstallPrompt() {
            // Create install banner
            const installBanner = document.createElement('div');
            installBanner.id = 'installBanner';
            installBanner.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; position: fixed; top: 0; left: 0; right: 0; z-index: 2000; display: flex; justify-content: space-between; align-items: center; font-size: 14px;">
                    <div>
                        <strong>ğŸ“± í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ì„¸ìš”!</strong><br>
                        <small>ì•±ì²˜ëŸ¼ ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</small>
                    </div>
                    <div>
                        <button onclick="installPWA()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 10px;">ì„¤ì¹˜</button>
                        <button onclick="closeInstallBanner()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">Ã—</button>
                    </div>
                </div>
            `;
            document.body.prepend(installBanner);
            
            // Adjust container top margin
            document.querySelector('.container').style.marginTop = '80px';
        }

        function installPWA() {
            if (deferredPrompt) {
                // Show the prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                        closeInstallBanner();
                    }
                    deferredPrompt = null;
                });
            }
        }

        function closeInstallBanner() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.remove();
                document.querySelector('.container').style.marginTop = '0';
            }
        }

        // Handle app installed
        window.addEventListener('appinstalled', (evt) => {
            console.log('App was installed');
            closeInstallBanner();
        });

        // iOS Safari specific install guidance
        function showIOSInstallGuide() {
            if (isIOS() && !isStandalone()) {
                setTimeout(() => {
                    if (!document.getElementById('installBanner')) {
                        const iosGuide = document.createElement('div');
                        iosGuide.innerHTML = `
                            <div style="background: #007AFF; color: white; padding: 15px; position: fixed; bottom: 0; left: 0; right: 0; z-index: 2000; text-align: center; font-size: 14px;">
                                <div style="margin-bottom: 10px;">
                                    <strong>ğŸ“± í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ê¸°</strong>
                                </div>
                                <div style="font-size: 12px;">
                                    Safari í•˜ë‹¨ì˜ <strong>ê³µìœ  ë²„íŠ¼ ğŸ“¤</strong>ì„ ëˆ„ë¥´ê³ <br>
                                    <strong>"í™ˆ í™”ë©´ì— ì¶”ê°€"</strong>ë¥¼ ì„ íƒí•˜ì„¸ìš”
                                </div>
                                <button onclick="this.parentElement.remove()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); color: white; padding: 5px 15px; border-radius: 15px; cursor: pointer; margin-top: 10px;">í™•ì¸</button>
                            </div>
                        `;
                        document.body.appendChild(iosGuide);
                    }
                }, 3000);
            }
        }

        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }

        function isStandalone() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        initApp();
        checkNotificationPermission();
        showIOSInstallGuide();
        
        setInterval(updateWeekInfo, 60000);
    </script>
</body>
</html>